# خطة تنفيذ 8 ساعات (Execution Plan)

> الهدف: تقسيم العمل إلى موجات قصيرة ومستقلة لتقليل التعارض أثناء التنفيذ المتواصل (Continuous Execution).

## Wave 1 (الساعتان 0–2): تثبيت الأساس التقني والبيانات

**الهدف**
- تجهيز أساس موثوق لبيانات الحقول ولوحة التطبيق بحيث يمكن لباقي الموجات البناء عليه بدون تعطيل.

**المهام (30–90 دقيقة لكل مهمة)**
1. **(45 دقيقة)** تدقيق نماذج البيانات المبدئية وربطها مع استخدامات الواجهة الحالية.
2. **(45 دقيقة)** مراجعة تدفق البيانات التجريبية وتوحيد التسمية بين `demo-data` و`types`.
3. **(30 دقيقة)** تحديث توثيق سريع لمسار البيانات من المصدر حتى العرض في الواجهة.

**الملفات المتوقعة للتعديل**
- `apps/web/lib/types.ts`
- `apps/web/lib/demo-data.ts`
- `docs/ARCHITECTURE.md`

**معيار القبول**
- كل نوع بيانات مستخدم في صفحات التطبيق الرئيسية معروف بوضوح في `types.ts`.
- لا توجد خصائص غير مستخدمة أو متضاربة في بيانات العرض التجريبي.
- توثيق المعمارية يصف تدفق البيانات بنفس المصطلحات المستخدمة في الكود.

**أمر التحقق**
- `pnpm --filter @adham/web test`

---

## Wave 2 (الساعتان 2–4): تحسين صفحات التطبيق التشغيلية (App)

**الهدف**
- رفع وضوح واجهات التشغيل اليومية (المزارع، الحقول، التقارير) دون كسر البنية الحالية.

**المهام (30–90 دقيقة لكل مهمة)**
1. **(60 دقيقة)** تحسين عرض بطاقات التقارير والحالات المختصرة في صفحة التقارير.
2. **(45 دقيقة)** توحيد طريقة عرض بيانات الحقول في صفحات `farms` و`fields`.
3. **(30 دقيقة)** إضافة حالات واجهة واضحة للتحميل/الفراغ/الخطأ في الصفحات التشغيلية.

**الملفات المتوقعة للتعديل**
- `apps/web/components/reports/report-card.tsx`
- `apps/web/app/app/reports/page.tsx`
- `apps/web/app/app/farms/page.tsx`
- `apps/web/app/app/fields/[fieldId]/page.tsx`

**معيار القبول**
- يظهر للمستخدم سياق واضح للحالة الحالية (Loading/Empty/Error) في كل صفحة تشغيلية معدّلة.
- مخرجات مكونات التقارير متوافقة بصريًا ومنطقيًا مع بيانات الحقول.
- التعديلات لا تتطلب تغييرًا في واجهات API الحالية.

**أمر التحقق**
- `pnpm --filter @adham/web test`

---

## Wave 3 (الساعتان 4–6): رفع موثوقية وظائف Supabase Edge

**الهدف**
- تقليل احتمالات الفشل الصامت وتحسين قابلية مراقبة وظائف البيانات المناخية والغطاء النباتي.

**المهام (30–90 دقيقة لكل مهمة)**
1. **(60 دقيقة)** تحسين معالجة الأخطاء في `fetch-weather-daily` مع رسائل سجل قابلة للتتبع.
2. **(45 دقيقة)** تحسين التحقق من المدخلات في `fetch-ndvi` قبل استدعاء المزود الخارجي.
3. **(30 دقيقة)** إضافة تحديثات توثيق تشغيلية قصيرة للسيناريوهات الشائعة للفشل.

**الملفات المتوقعة للتعديل**
- `supabase/functions/fetch-weather-daily/index.ts`
- `supabase/functions/fetch-ndvi/index.ts`
- `docs/RUNBOOK.md`

**معيار القبول**
- أي طلب غير صالح يُرفض برسالة خطأ واضحة وبصيغة ثابتة.
- سجلات الأخطاء تميّز بين أخطاء المدخلات، ومشاكل المزود الخارجي، وأخطاء النظام الداخلية.
- توثيق التشغيل يوضح الاستجابة السريعة لأكثر حالتي فشل تكرارًا.

**أمر التحقق**
- `pnpm --filter @adham/lib test`

---

## Wave 4 (الساعتان 6–8): الجاهزية للإطلاق والتوثيق النهائي

**الهدف**
- إغلاق الدورة بجودة قابلة للتسليم: أمن، تشغيل، وتوافق وثائقي مع الواقع الحالي.

**المهام (30–90 دقيقة لكل مهمة)**
1. **(45 دقيقة)** مراجعة سريعة لمتطلبات الأمن التشغيلي وتحديث عناصر ناقصة في التوثيق.
2. **(45 دقيقة)** مطابقة دليل التشغيل مع الوظائف المجدولة والتنبيهات الصحية.
3. **(30 دقيقة)** تدقيق نهائي للتوثيق العام وإعداد قائمة تسليم (handover checklist).

**الملفات المتوقعة للتعديل**
- `docs/SECURITY.md`
- `docs/RUNBOOK.md`
- `docs/PRODUCT.md`
- `docs/ARCHITECTURE.md`

**معيار القبول**
- وثائق الأمن والتشغيل تغطي الأدنى المطلوب قبل الإطلاق (Secrets, Rotation, Monitoring).
- يوجد checklist واضح للتسليم يختصر ما تم إنجازه وما تبقى.
- جميع الموجات السابقة موثقة بحالة (Done / Deferred) داخل ملف التخطيط أو ملف التسليم.

**أمر التحقق**
- `pnpm lint && pnpm --filter @adham/web test`

---

## مبادئ تقليل التعارض أثناء التنفيذ المتواصل

- اجعل كل مهمة قابلة للدمج بشكل مستقل (Small PR mindset).
- امنع التعديلات المتزامنة على نفس الملفات قدر الإمكان بين أفراد/دفعات التنفيذ.
- ثبّت العقود (Types + API Shape) مبكرًا في Wave 1 لتقليل إعادة العمل لاحقًا.
- فضّل التوسعة على إعادة الهيكلة الجذرية خلال نافذة الـ 8 ساعات.
- بعد كل مهمة: نفّذ أمر التحقق وسجّل نتيجة مختصرة (Pass/Fail + ملاحظة واحدة).
