# بروتوكول التنفيذ الذاتي (Autonomous Execution Protocol)

## الهدف
هذا المستند يعرّف طريقة عمل موحّدة لأي تنفيذ ذاتي داخل المشروع بحيث يكون قابلًا للتتبّع، آمنًا، وقابلًا للمراجعة.

## 1) ترتيب التنفيذ الإلزامي
يتم التنفيذ دائمًا بالترتيب التالي:

1. **Discovery (الاكتشاف)**
2. **Implementation (التنفيذ)**
3. **Validation (التحقق)**
4. **PR Notes (ملاحظات طلب الدمج)**

> لا يجوز القفز إلى مرحلة لاحقة قبل استيفاء معايير الخروج من المرحلة الحالية.

---

## 2) تفاصيل المراحل ومعايير الدخول/الخروج

### المرحلة 1: Discovery
**الهدف:** فهم المطلوب بدقة قبل تعديل أي ملف.

**أنشطة أساسية:**
- تحليل نطاق الطلب والمخرجات المتوقعة.
- مراجعة الملفات ذات الصلة والتعليمات المحلية (مثل AGENTS.md إن وجدت).
- تحديد المخاطر المحتملة (تقنية/أمنية/تشغيلية).
- إعداد خطة تنفيذ قصيرة قابلة للقياس.

**مخرجات إلزامية:**
- تعريف واضح لـ:
  - ما سيتم تغييره.
  - ما لن يتم تغييره.
  - معايير قبول قابلة للتحقق.

**قاعدة الانتقال إلى Implementation:**
- ✅ وجود خطة واضحة.
- ✅ تحديد الملفات المستهدفة.
- ✅ عدم وجود غموض يعيق التنفيذ.

إذا بقي غموض جوهري، يتم **الإيقاف المؤقت** وتوثيق نقطة الحجب في تقرير التقدم.

---

### المرحلة 2: Implementation
**الهدف:** تنفيذ التغييرات بأقل أثر جانبي ممكن.

**أنشطة أساسية:**
- تطبيق التعديلات وفق الخطة المعتمدة من Discovery.
- الالتزام بمعايير التنسيق والأسلوب الخاصة بالمشروع.
- تجنّب إدخال تغييرات خارج نطاق الطلب.

**مخرجات إلزامية:**
- تغييرات واضحة ومركّزة.
- تحديث أي قوالب/مستندات مرتبطة عند الحاجة.

**قاعدة الانتقال إلى Validation:**
- ✅ اكتمال التعديلات المطلوبة ضمن النطاق.
- ✅ عدم وجود مهام تنفيذية مفتوحة تعيق التحقق.

إذا ظهر تعارض معماري أو مخاطر غير متوقعة، يُعاد فتح Discovery بشكل موجز ثم تُستأنف Implementation.

---

### المرحلة 3: Validation
**الهدف:** التأكد من سلامة النتائج قبل أي تسليم.

**أنشطة أساسية:**
- تشغيل الاختبارات/الفحوصات المناسبة (حسب ما هو متاح بالمشروع).
- مراجعة تأثير التغييرات على الأمن، التشغيل، والاستقرار.
- توثيق نتائج الفحوصات (نجاح/فشل/تعذر بيئة).

**مخرجات إلزامية:**
- قائمة فحوصات مع الحالة.
- ملاحظات المخاطر المتبقية (إن وجدت).

**قاعدة الانتقال إلى PR Notes:**
- ✅ نجاح الفحوصات الحرجة، أو
- ⚠️ توثيق واضح لأي قيود بيئية مع أثرها وخطة التخفيف.

أي فشل حرج غير مبرر يمنع الانتقال للمرحلة التالية.

---

### المرحلة 4: PR Notes
**الهدف:** تجهيز ملخص قابل للمراجعة لطلب الدمج.

**أنشطة أساسية:**
- تلخيص ما تغيّر ولماذا.
- سرد الاختبارات المنفذة ونتائجها.
- توضيح المخاطر المتبقية وخطوات المتابعة.

**مخرجات إلزامية:**
- عنوان PR واضح.
- وصف شامل يتضمن: النطاق، التحقق، المخاطر، وخطة الرجوع (عند الحاجة).

---

## 3) قواعد الانتقال بين المراحل (Stage Gates)

- الانتقال **أحادي الاتجاه** افتراضيًا: Discovery → Implementation → Validation → PR Notes.
- يسمح بالرجوع فقط في حال:
  - ظهور متطلب جديد يغيّر النطاق.
  - اكتشاف مشكلة معمارية/أمنية تتطلب إعادة تصميم.
- كل انتقال يجب أن يجيب صراحةً عن:
  1. ما الذي اكتمل؟
  2. ما الدليل؟
  3. ما المخاطر المفتوحة؟

---

## 4) شروط الإيقاف التلقائي (Automatic Stop Conditions)

يجب إيقاف التنفيذ تلقائيًا (Hard Stop) عند تحقق أي شرط مما يلي:

1. **فشل اختبار حرج**
   - مثال: اختبار وحدة أساسي، فحص بناء (build) فاشل، أو كسر تدفق رئيسي.
   - الإجراء: إيقاف الانتقال، توثيق الفشل، والبدء بخطة إصلاح قبل المتابعة.

2. **مخاطرة أمنية عالية/حرجة**
   - مثال: تسريب أسرار، ثغرة صلاحيات، تعطيل ضوابط حماية.
   - الإجراء: تجميد الدمج، تصعيد فوري، وتوثيق تقييم المخاطر.

3. **تعذر بيئة يمنع التحقق**
   - مثال: اعتماد خارجي غير متاح، خدمة اختبار غير قابلة للوصول.
   - الإجراء: توثيق واضح لنوع التعذر، ما الذي تعذر اختباره، وتأثير ذلك على الثقة.

> لا يجوز تجاوز الإيقاف التلقائي إلا مع توثيق استثناء صريح يحدد المسؤولية والمخاطر المتبقية.

---

## 5) إيقاع التتبع الزمني

- يتم نشر **تقرير تقدّم كل ساعة** أثناء العمل.
- يجب استخدام القالب الرسمي:
  - `docs/templates/HOURLY_PROGRESS_TEMPLATE.md`

الحد الأدنى لكل تحديث:
- نسبة الإنجاز مقابل الخطة.
- ما تم إنجازه فعليًا في الساعة الأخيرة.
- المعيقات/المخاطر.
- خطة الساعة التالية.

---

## 6) تعريف الاكتمال (Definition of Done)

يُعتبر التنفيذ مكتملًا فقط عند:
- اكتمال المراحل الأربع بالترتيب.
- عدم وجود شروط إيقاف تلقائي مفتوحة بلا معالجة.
- توثيق نتائج التحقق بوضوح.
- تجهيز PR Notes قابلة للمراجعة واتخاذ القرار.
